services:
  postgres:
    image: public.ecr.aws/docker/library/postgres:12-alpine
    container_name: superposition_postgres
    volumes:
        - ./docker-compose/postgres/db_init.sql:/docker-entrypoint-initdb.d/db_init.sql
    ports:
      - "5432:5432"
    environment:
      POSTGRES_PASSWORD: "docker"
      POSTGRES_DB: "config"
    restart: on-failure
    network_mode: bridge
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  localstack:
    image: public.ecr.aws/localstack/localstack:1.3.0
    container_name: superposition_localstack
    ports:
      - "4510-4559:4510-4559"  # external service port range
      - "4566:4566"            # LocalStack Edge Proxy
      - "4571:4571"
    network_mode: bridge
    environment:
      LOCALSTACK_SERVICES: s3, sns, sqs, logs, cloudwatch, kms
      AWS_DEFAULT_REGION: ap-south-1
      AWS_ACCESS_KEY_ID: test
      AWS_SECRET_ACCESS_KEY: test
      EDGE_PORT: 4566
    healthcheck:
      test: ["CMD-SHELL", "aws --endpoint-url=http://localhost:4566 --region=ap-south-1 sts get-caller-identity"]
      interval: 10s
      timeout: 5s
      retries: 5

#   redis:
#     image: redis:7
#     container_name: superposition_redis
#     restart: on-failure
#     ports:
#       - 6379:6379
#     command: redis-server
#     network_mode: bridge

#   app:
#     image: superposition_github:latest
#     container_name: superposition_app
#     ports:
#       - "8080:8080"
#     env_file:
#       - .env
#     depends_on:
#       - postgres
#       - localstack
#     network_mode: bridge
#     restart: on-failure
